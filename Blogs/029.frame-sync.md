---
title: "修正歧义：帧锁定同步&按帧同步&状态同步"
date: 2021-03-16T21:37:54+08:00
draft: false
isCJKLanguage: true
tags:
- GameDev
---



原文链接：https://zhuanlan.zhihu.com/p/32843758

## 帧锁定同步：frame lockstep sync

每一帧的运算都要依赖上一帧的数据，也就是所谓的上下文强相关

优点：同步数据少

缺点：

- 对数据误差极度敏感，任何差错都会因蝴蝶效应被放大
- 所有逻辑都必须计算（包括视野外的），导致客户端运算量增加
- 因为整个游戏状态都必须存在于客户端，数据对“外挂”透明
- 当本地状态遗失后（断网或应用崩溃），必须获得一个非常大的数据包来恢复状态，因为必须包含视野外，以及一些客户端本不需要关心的内容

对于MOBA类游戏而言，场景小、数据量小，上述缺点不算是缺点



## 状态同步：status sync

无法保证客户机上看到的画面是一致的，只能保证看到的内容不会差别特别大

为了减少同步的数据量，通常只会将变化的数据进行同步。（所以ECS自带的数据切分对状态同步天生亲和，只要对Component写一个dirty机制，然后只需要同步dirty的component即可）

它与frame sync不冲突，只要是按帧的做status sync，就是frame sync



## 帧同步：frame sync

每一帧执行状态同步

LOL 使用的就是这种



## 最后

- **lockstep**无法降低游戏延迟，反而还会增加延迟。**lockstep**或者说**按帧同步frame sync**，保证的是画面的一致性。延迟只能靠优化网络速度和本地预测降低。
- 同步精度和同步方式无关，只和服务器帧的频率和同步频率有关。频率越高精度自然就越高，就越不容易出现暂时性的画面错误。
- 是否能通过录像文件重放，只需要“伪随机数”和“固定间隔运行”即可，和“**同步”**无关。以前的FC模拟器就有完整的录像功能，难不成那也是**lockstep**了？
- "lockstep（步调一致）"缩写成"lock（锁）"这个**缩写本身就是错的**这件事，就不用提了。毕竟这个缩写错误只会导致迷惑，并不会导致歧义。
- lockstep不是MOBA游戏的唯一解，本来也不是。但是按帧同步确实是必须的。



## 三者的关系图

![](https://raw.githubusercontent.com/lightjiao/lightjiao.github.io/develop/static/images/029/frame_sync.jpg)

